<div class="main" ng-class="{'main--has-feedback': $ctrl.showFeedback}">
  <main-toolbar game="$ctrl.game" ng-dblclick="debug = !debug"></main-toolbar>
  <main-debug game="$ctrl.game" ng-if="debug"></main-debug>

  <div class="main__steps" ui-view scroll-glue>
    <div class="main__steps__item card card-block" ng-repeat="step in $ctrl.game.journey">
      <p class="main__steps__item__slice" ng-repeat="slice in step.slices | limitTo:(step.slice + 1)" ng-click="$ctrl.game.nextSlice()">
        <span class="main__steps__item__slice__wrapper">
          {{ :: slice.text }}
        </span>
      </p>
      <p class="main__steps__item__slice" ng-if="!step.isLastSlice()">
        <span class="main__steps__item__slice__wrapper main__steps__item__slice__wrapper--typing">
          <img src="//logo-js.herokuapp.com/loading-three-dots/999" height="8px" />
        </span>
      </p>
      <fieldset ng-disabled="step.selection" class="main__steps__item__choices" ng-if="step.isLastSlice()">
        <div class="list-unstyled row mb-0">
          <div class="col-lg mt-1 main__steps__item__choices__btn" ng-class="{Â 'col-lg-6': step.choices.length > 3 }" ng-repeat="choice in :: step.choices">
            <button class="btn btn-block btn-primary" ng-click="step.select(choice)" ng-class="{ active: step.selection == choice }">
              {{ :: choice.text }}
            </button>
          </div>
        </div>
      </fieldset>
      <fieldset ng-if="step.selection" ng-disabled="!step.isPrevious()">
        <button class="btn btn-block btn-link btn-sm main__steps__item__undo my-2" ng-click="$ctrl.game.undo()">
          Undo the last action
        </button>
      </fieldset>
      <div class="mt-4" ng-if="step.selection && step.selection.hasFeedback()">
        <p class="main__steps__item__slice main__steps__item__slice--feedback" ng-repeat="slice in step.selection.slices | limitTo:(step.selection.slice + 1)"  ng-click="$ctrl.game.nextSlice()">
          <span class="main__steps__item__slice__wrapper">
            {{ :: slice.text }}
          </span>
        </p>
        <p class="main__steps__item__slice" ng-if="!step.selection.isLastSlice()">
          <span class="main__steps__item__slice__wrapper main__steps__item__slice--feedback main__steps__item__slice__wrapper--typing">
            <img src="//logo-js.herokuapp.com/loading-three-dots/999" height="8px" />
          </span>
        </p>
      </div>
    </div>
  </div>

  <div class="main__picture" ng-repeat="picture in $ctrl.game.pictures" ng-show="picture === $ctrl.game.picture">
    <img ng-src="{{ picture }}"  class="main__picture__img" />
  </div>

  <div class="main__timeline">
    <div class="container-fluid">
      <div class="row">
        <div ng-repeat="year in :: $ctrl.game.years" class="col main__timeline__year"  ng-class="{ 'main__timeline__year--active':  year <= $ctrl.game.step.year }">
          <div class="main__timeline__year__label">
            {{ :: year }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="main__modal" ng-if="$ctrl.game.isOver() && !$ctrl.showFeedback">
    <div class="main__modal__overlay"></div>
    <div class="main__modal__card card card-block">
      <div ng-bind-html="$ctrl.game.end.text | unsafe"></div>
      <div class="text-right">
        <button class="btn btn-link float-left" ng-click="$ctrl.game.undo()">
          Undo the last action
        </button>
        <button class="btn btn-primary" ng-click="$ctrl.playAgain()">
          Play again
        </button>
      </div>
    </div>
  </div>

</div>
