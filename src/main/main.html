<div class="main" ng-class="{'main--has-feedback': $ctrl.showFeedback}">
  <main-toolbar game="$ctrl.game" ng-dblclick="debug = !debug"></main-toolbar>
  <main-debug game="$ctrl.game" ng-if="debug"></main-debug>

  <div class="main__steps" ui-view scroll-glue data-last-action="{{ $ctrl.lastAction }}">
    <div class="main__steps__item card card-block" ng-repeat="step in $ctrl.game.journey">
      <fieldset ng-if="!$first" ng-disabled="!$last">
        <button class="btn btn-block btn-link btn-sm main__steps__item__undo mb-4" ng-click="$ctrl.game.undo()">
          Undo the last action
        </button>
      </fieldset>
      <p class="main__steps__item__slice" ng-repeat="sentence in step.text | limitTo:(step.slice + 1)" ng-click="step.nextSlice()">
        <span class="main__steps__item__slice__wrapper">
          {{ sentence }}
        </span>
      </p>
      <fieldset ng-disabled="!step.isCurrent()" class="main__steps__item__choices" ng-if="step.isLastSlice()">
        <div class="list-unstyled row mb-0">
          <div class="col-lg mt-1 main__steps__item__choices__btn" ng-class="{Â 'col-lg-6': step.choices.length > 3 }" ng-repeat="choice in step.choices">
            <button class="btn btn-block btn-primary" ng-click="step.select(choice)" ng-class="{ active: step.selection == choice }">
              {{ choice.text }}
            </button>
          </div>
        </div>
      </fieldset>
      <p class="main__steps__item__slice mt-4" ng-if="step.selection.feedback">
        <span class="main__steps__item__slice__wrapper">
          {{ step.selection.feedback }}
        </span>
      </p>
    </div>
  </div>

  <div class="main__timeline">
    <div class="container-fluid">
      <div class="row">
        <div ng-repeat="year in $ctrl.game.years" class="col main__timeline__year"  ng-class="{ 'main__timeline__year--active':  year <= $ctrl.game.step.year }">
          <div class="main__timeline__year__label">
            {{ ::year }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="main__modal" ng-if="$ctrl.game.isOver() && !$ctrl.showFeedback">
    <div class="main__modal__overlay"></div>
    <div class="main__modal__card card card-block">
      <div ng-bind-html="$ctrl.game.end.text | unsafe"></div>
      <div class="text-right">
        <button class="btn btn-link float-left" ng-click="$ctrl.game.undo()">
          Undo the last action
        </button>
        <button class="btn btn-primary" ng-click="$ctrl.playAgain()">
          Play again
        </button>
      </div>
    </div>
  </div>

</div>
